<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>PDF OCR Tool</title>
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            body {
                font-family:
                    -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
                    Oxygen, Ubuntu, Cantarell, sans-serif;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                min-height: 100vh;
                padding: 2rem;
            }

            .container {
                max-width: 1200px;
                margin: 0 auto;
                background: white;
                border-radius: 12px;
                box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
                overflow: hidden;
            }

            .header {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                padding: 2rem;
                text-align: center;
            }

            .header h1 {
                font-size: 2rem;
                margin-bottom: 0.5rem;
            }

            .header p {
                opacity: 0.9;
            }

            .main {
                padding: 2rem;
            }

            .upload-area {
                border: 3px dashed #ddd;
                border-radius: 8px;
                padding: 3rem;
                text-align: center;
                transition: all 0.3s ease;
                cursor: pointer;
                background: #fafafa;
            }

            .upload-area:hover,
            .upload-area.dragover {
                border-color: #667eea;
                background: #f0f4ff;
            }

            .upload-area input[type="file"] {
                display: none;
            }

            .upload-icon {
                font-size: 3rem;
                margin-bottom: 1rem;
            }

            .btn {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                border: none;
                padding: 0.75rem 2rem;
                border-radius: 6px;
                font-size: 1rem;
                cursor: pointer;
                transition: transform 0.2s;
                margin: 0.5rem;
            }

            .btn:hover {
                transform: translateY(-2px);
            }

            .btn:disabled {
                opacity: 0.5;
                cursor: not-allowed;
            }

            .progress-container {
                margin: 2rem 0;
                display: none;
            }

            .progress-bar {
                width: 100%;
                height: 30px;
                background: #f0f0f0;
                border-radius: 15px;
                overflow: hidden;
            }

            .progress-fill {
                height: 100%;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                transition: width 0.3s ease;
                display: flex;
                align-items: center;
                justify-content: center;
                color: white;
                font-weight: bold;
            }

            .status {
                margin-top: 1rem;
                padding: 1rem;
                background: #f0f4ff;
                border-radius: 6px;
                color: #667eea;
            }

            .output-container {
                margin-top: 2rem;
                display: none;
            }

            .output-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 1rem;
            }

            .output-text {
                width: 100%;
                min-height: 400px;
                padding: 1rem;
                border: 1px solid #ddd;
                border-radius: 6px;
                font-family: "Monaco", "Courier New", monospace;
                font-size: 0.9rem;
                resize: vertical;
                background: #fafafa;
            }

            .preview-canvas {
                display: none;
                max-width: 100%;
                margin: 1rem 0;
                border: 1px solid #ddd;
                border-radius: 6px;
            }

            .page-controls {
                display: none;
                margin: 1rem 0;
                text-align: center;
            }

            .stats {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 1rem;
                margin: 1rem 0;
            }

            .stat-card {
                padding: 1rem;
                background: #f8f9fa;
                border-radius: 6px;
                text-align: center;
            }

            .stat-value {
                font-size: 1.5rem;
                font-weight: bold;
                color: #667eea;
            }

            .stat-label {
                color: #666;
                font-size: 0.9rem;
                margin-top: 0.25rem;
            }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1>üìÑ PDF OCR Tool</h1>
                <p>
                    Extract text from PDFs using OCR - Perfect for scanned
                    documents
                </p>
            </div>

            <div class="main">
                <div class="upload-area" id="uploadArea">
                    <input type="file" id="fileInput" accept=".pdf" />
                    <div class="upload-icon">üìÅ</div>
                    <h3>Drop PDF here or click to browse</h3>
                    <p>Supports scanned PDFs and image-based documents</p>
                </div>

                <div class="progress-container" id="progressContainer">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill">0%</div>
                    </div>
                    <div class="status" id="status">Initializing...</div>
                </div>

                <div class="page-controls" id="pageControls">
                    <button class="btn" id="prevPage">‚Üê Previous</button>
                    <span id="pageInfo">Page 1 of 1</span>
                    <button class="btn" id="nextPage">Next ‚Üí</button>
                </div>

                <canvas class="preview-canvas" id="previewCanvas"></canvas>

                <div class="output-container" id="outputContainer">
                    <div class="output-header">
                        <h3>Extracted Text</h3>
                        <div>
                            <button class="btn" id="copyBtn">
                                üìã Copy to Clipboard
                            </button>
                            <button class="btn" id="downloadBtn">
                                üíæ Download Text
                            </button>
                            <button class="btn" id="processNewBtn">
                                üîÑ Process New PDF
                            </button>
                        </div>
                    </div>

                    <div class="stats" id="stats">
                        <div class="stat-card">
                            <div class="stat-value" id="pageCount">0</div>
                            <div class="stat-label">Total Pages</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="wordCount">0</div>
                            <div class="stat-label">Words</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="charCount">0</div>
                            <div class="stat-label">Characters</div>
                        </div>
                    </div>

                    <textarea
                        class="output-text"
                        id="outputText"
                        placeholder="Extracted text will appear here..."
                    ></textarea>
                </div>
            </div>
        </div>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
        <script src="https://unpkg.com/tesseract.js@4.1.1/dist/tesseract.min.js"></script>
        <script>
            pdfjsLib.GlobalWorkerOptions.workerSrc =
                "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js";

            const uploadArea = document.getElementById("uploadArea");
            const fileInput = document.getElementById("fileInput");
            const progressContainer =
                document.getElementById("progressContainer");
            const progressFill = document.getElementById("progressFill");
            const status = document.getElementById("status");
            const outputContainer = document.getElementById("outputContainer");
            const outputText = document.getElementById("outputText");
            const previewCanvas = document.getElementById("previewCanvas");
            const pageControls = document.getElementById("pageControls");
            const pageInfo = document.getElementById("pageInfo");
            const prevPage = document.getElementById("prevPage");
            const nextPage = document.getElementById("nextPage");
            const copyBtn = document.getElementById("copyBtn");
            const downloadBtn = document.getElementById("downloadBtn");
            const processNewBtn = document.getElementById("processNewBtn");
            const pageCountEl = document.getElementById("pageCount");
            const wordCountEl = document.getElementById("wordCount");
            const charCountEl = document.getElementById("charCount");

            let currentPDF = null;
            let currentPage = 1;
            let totalPages = 0;
            let extractedTexts = [];
            let isProcessing = false;
            let processingPage = 1;

            uploadArea.addEventListener("click", () => fileInput.click());

            uploadArea.addEventListener("dragover", (e) => {
                e.preventDefault();
                uploadArea.classList.add("dragover");
            });

            uploadArea.addEventListener("dragleave", () => {
                uploadArea.classList.remove("dragover");
            });

            uploadArea.addEventListener("drop", (e) => {
                e.preventDefault();
                uploadArea.classList.remove("dragover");
                const files = e.dataTransfer.files;
                if (files.length > 0 && files[0].type === "application/pdf") {
                    processPDF(files[0]);
                }
            });

            fileInput.addEventListener("change", (e) => {
                if (e.target.files.length > 0) {
                    processPDF(e.target.files[0]);
                }
            });

            prevPage.addEventListener("click", () => {
                if (currentPage > 1 && !isProcessing) {
                    currentPage--;
                    renderPage(currentPage);
                }
            });

            nextPage.addEventListener("click", () => {
                if (currentPage < totalPages && !isProcessing) {
                    currentPage++;
                    renderPage(currentPage);
                }
            });

            copyBtn.addEventListener("click", () => {
                outputText.select();
                document.execCommand("copy");
                copyBtn.textContent = "‚úì Copied!";
                setTimeout(() => {
                    copyBtn.textContent = "üìã Copy to Clipboard";
                }, 2000);
            });

            downloadBtn.addEventListener("click", () => {
                const blob = new Blob([outputText.value], {
                    type: "text/plain",
                });
                const url = URL.createObjectURL(blob);
                const a = document.createElement("a");
                a.href = url;
                a.download = "extracted_text.txt";
                a.click();
                URL.revokeObjectURL(url);
            });

            processNewBtn.addEventListener("click", () => {
                location.reload();
            });

            async function processPDF(file) {
                uploadArea.style.display = "none";
                progressContainer.style.display = "block";
                previewCanvas.style.display = "block";
                pageControls.style.display = "block";

                updateProgress(0, "Loading PDF...");

                try {
                    const arrayBuffer = await file.arrayBuffer();
                    const pdf = await pdfjsLib.getDocument(arrayBuffer).promise;
                    currentPDF = pdf;
                    totalPages = pdf.numPages;
                    extractedTexts = new Array(totalPages);
                    isProcessing = true;
                    processingPage = 1;

                    pageCountEl.textContent = totalPages;
                    updatePageInfo();

                    // Render first page immediately for preview
                    await renderPage(1);

                    updateProgress(5, `Processing ${totalPages} pages...`);

                    // Start OCR processing in background
                    processOCR();
                } catch (error) {
                    console.error("Error loading PDF:", error);
                    status.textContent = `Error: ${error.message}`;
                    status.style.background = "#ffe0e0";
                    status.style.color = "#d00";
                    isProcessing = false;
                }
            }

            async function processOCR() {
                try {
                    const worker = await Tesseract.createWorker({
                        logger: (m) => {
                            if (
                                m.status === "recognizing text" &&
                                isProcessing
                            ) {
                                const pageProgress = Math.floor(
                                    m.progress * 100,
                                );
                                const overallProgress =
                                    5 +
                                    (90 / totalPages) * (processingPage - 1) +
                                    (90 / totalPages) * m.progress;
                                updateProgress(
                                    overallProgress,
                                    `Page ${processingPage}/${totalPages}: OCR ${pageProgress}%`,
                                );
                            }
                        },
                    });

                    await worker.loadLanguage("eng");
                    await worker.initialize("eng");

                    let allText = "";

                    for (let pageNum = 1; pageNum <= totalPages; pageNum++) {
                        if (!isProcessing) break;

                        processingPage = pageNum;

                        const page = await currentPDF.getPage(pageNum);

                        const scale = 2.0;
                        const viewport = page.getViewport({ scale });

                        const canvas = document.createElement("canvas");
                        const context = canvas.getContext("2d");
                        canvas.width = viewport.width;
                        canvas.height = viewport.height;

                        await page.render({
                            canvasContext: context,
                            viewport: viewport,
                        }).promise;

                        updateProgress(
                            5 + (90 / totalPages) * (pageNum - 1),
                            `Page ${pageNum}/${totalPages}: Starting OCR...`,
                        );

                        const imageData = canvas.toDataURL("image/png");
                        const {
                            data: { text },
                        } = await worker.recognize(imageData);

                        extractedTexts[pageNum - 1] = text;
                        allText += `\n--- Page ${pageNum} ---\n${text}\n`;

                        outputText.value = allText.trim();
                        updateStats(allText);
                    }

                    await worker.terminate();

                    isProcessing = false;
                    updateProgress(100, "OCR Complete!");
                    outputContainer.style.display = "block";

                    setTimeout(() => {
                        progressContainer.style.display = "none";
                    }, 2000);
                } catch (error) {
                    console.error("Error during OCR:", error);
                    status.textContent = `Error: ${error.message}`;
                    status.style.background = "#ffe0e0";
                    status.style.color = "#d00";
                    isProcessing = false;
                }
            }

            async function renderPage(pageNum) {
                if (!currentPDF) return;

                const page = await currentPDF.getPage(pageNum);
                const scale = 1.5;
                const viewport = page.getViewport({ scale });

                previewCanvas.width = viewport.width;
                previewCanvas.height = viewport.height;

                const context = previewCanvas.getContext("2d");

                await page.render({
                    canvasContext: context,
                    viewport: viewport,
                }).promise;

                updatePageInfo();
            }

            function updatePageInfo() {
                pageInfo.textContent = `Page ${currentPage} of ${totalPages}`;
                prevPage.disabled = currentPage <= 1;
                nextPage.disabled = currentPage >= totalPages;
            }

            function updateProgress(percent, message) {
                progressFill.style.width = percent + "%";
                progressFill.textContent = Math.round(percent) + "%";
                status.textContent = message;
            }

            function updateStats(text) {
                const words = text
                    .trim()
                    .split(/\s+/)
                    .filter((word) => word.length > 0);
                wordCountEl.textContent = words.length.toLocaleString();
                charCountEl.textContent = text.length.toLocaleString();
            }
        </script>
    </body>
</html>
